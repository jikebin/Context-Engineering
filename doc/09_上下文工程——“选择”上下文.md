# 结构“选择上下文”（Select Context）的核心策略

## 核心思想

- 从 “加载数据” 到 “注意力调度”
- “选择”是在Agent每次思考前，从所有可用信息中，动态决策将**哪些最关键的信息**加载到有限的上下文窗口中。

## 本期议程：四大可选信息源

1. 草稿纸：短期工作笔记
2. 长期记忆：持久化知识
3. 工具集：可执行的能力
4. 知识库：外部事实数据

## 从“草稿纸”中选择（内部信息）

核心逻辑：“选择”的机制，取决于“写入”的实现方式。

### 当作为“工具”实现时

Agent通过主动调用`read_scratchpad()`等工具，来“回忆”和选择它需要的历史步骤。


### 当作为“运行时状态”时

开发这通过代码进行**精细化控制**，按需 暴露状态。例如：
    * 滑动窗口：只加载最近N轮思考链。
    * 状态总结：只加载上一部的观察结果。

## 从“长期记忆”中选择（内部信息）

核心框架：使用人类记忆三分法来分类和选择记忆。

### 程序性记忆(如何做)
通过意图识别，动态选择并加载匹配当前任务的模块化指令集(如：“退货流程指南”)。

### 情景记忆(发生了什么)
通过向量搜索，从示例库中动态检索与当前问题最相似的Few-shot示例。

### 语义记忆(是什么)
通过RAG、混合检索等方式，选择事实性知识。

## 从“工具集”中选择（外部信息）

### 高级策略：RAG for Tools

为大量工具的描述建立RAG索引，在每次思考前预检索，只将最相关的Tok-K个工具动态加载到上下文中。

### 工具选择的架构权衡

- 动态选择(RAG):有限考虑扩展性与精准度，适用于工具集庞大、开放的场景。
- 主动+遮蔽（Masking）：优先考虑性能与延迟，通过复用KV缓存来加速，适用于工具集小而稳定的场景。

## 从“知识库”中选择（外部信息）

演进为 Agentic Search(由Agent主动、迭代地探索信息)

### 高级策略：混合检索（Hybrid Search）

* 多路召回：向量(语义)、关键词(词法)、知识图谱(关系)。
* Agentic探索：Agent在循环中，主动使用检索工具进行多步骤推理。
* 重排序（Re-ranking）:在召回后进行二次精选，提升信噪比。

## 警示

**一个错误的“选择”，比没有记忆更糟糕。**