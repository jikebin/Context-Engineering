# 为AI构建“记忆宫殿”——写入

深入解析上下文的“写入”机制（Write Context）


| 特性 | 草稿纸（Scratchpad） | 长期记忆（Memories） |
| ---- | -------------------| ------------------ |
| 核心类比 | 处理当前工作，用完即清理(办公桌/白板) | 归档重要结论，供未来查阅(档案柜/个人知识库) |
| 目的  | 辅助当前任务的成功执行   |  辅助未来所有任务，实现学习与进化 |
| 生命周期  | 任务级/会话内(易失) | 永久性/跨会话(持久)  |
| 内容粒度 | 详细的过程、总监步骤、原始数据 |提炼后的结论、经验、高级知识 |
| 核心作用 | 保证当前任务的逻辑连贯性 | 实现Agent的学习、进化和个性化 |


## 核心机制：存储与使用的分离

信息完整存储于窗口之外(应用内存)，仅在每次调用时选择性地载入，以对抗“上下文腐烂”。

### 模式一：显示工具调用

Agent主动调用`write_note`工具记录。

```markdown
1.Agent思考：“我的计划是：1.查股价；2.查新闻。现在执行第一步。”

2.Agent行动：调用`write_to_scratchpad`工具，将计划写入草稿纸。

3.Agent思考：股价已获取：950美元。现在执行第二步。

4.Agent行动：再次调用`write_to_scratchpad`,将观察结果写入草稿纸。
```

优点：行为透明，可调式性强。
缺点：对模型要求高，增加token开销。

### 模式二：隐式格式驱动

框架自动捕捉`Thought:`等格式内容。

```markdown
1.Agent输出：
    **思考**：任务需要分三步，...
    **行动**：调用`get_stock_price`工具
2.框架处理：
    - 自动提取“思考”内容，存入草稿纸。
    - 自动执行“行动”内容。
```
优点：高效、自动化，更符合思考流。
缺点：依赖框架实现，相对黑盒。

## 长期记忆系统——知识的沉淀与进化

核心挑战：如何从海量观察中，智能地提炼高价值信息？

### 机制一：Reflexion(反思)

从错误中学习，提炼规则(事件驱动)。

```markdown
1.失败检测（由框架完成）：
    行动：search("Apple revenue")
    观察：返回了手机新闻，而非财报。
2.生成元提示（由框架完成）：
    向LLM提问：“回顾这册失败，生成一条可复用的规则来避免未来犯错。”
3.生成并写入记忆：
    产出(行为策略)：“当我搜索公司财报时，应加入‘季度收益’等关键词。”
```

### 机制二：Generative Agents

从观察中总结，合成洞察（周期性）。

```markdown
1.原始日志收集：
    * 10:05:张三提到“预算紧张”。
    * 14:30:收到李四关于“成本消减”的邮件。
2.启动合成流程(Prompt链)：
    * 提问：“总结以上日志的核心动态。”
        回答：“张三和李四都讨论了预算问题。”
    * 提问：“基于此总结，有何新洞察？”
3.生成并写入记忆：
    产出(高级事实)：“洞察：项目X正面临显著的预算风险。”
```
