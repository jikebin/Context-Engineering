# 上下文工程的4大支柱

①.Context Offloading (上下文卸载)：将信息从核心的对话历史中移出，存放到外部系统（如文件系统），只在上下文中保留一个轻量级的引用

②.Reducing Context (上下文精简)：通过总结或压缩来减少信息量，例如修剪旧的工具调用记录

③.Retrieving Context (上下文检索)：在需要时，按需从外部系统将信息取回。实现方式包括基于索引的语义搜索，或更简单的基于文件系统的搜索工具（如 glob 和 grep）

④.Context Isolation (上下文隔离)：通过将任务分解给多个子代理（sub-agents），每个子代理拥有自己独立的、更小的上下文窗口，从而实现关注点分离和上下文管理

## 1.上下文卸载

- 可逆的瘦身：删除那些可以从外部（如文件系统）重建的信息。
- 一个工具调用，完整信息是{path: "file.txt", content: "..."}。在“压缩”后，只保留{path: "file.txt"}。
- 优势：信息“零”丢失，只是被“外置”了。

## 2.上下文精简

- 不可以瘦身：对历史信息进行总结，彻底丢弃原文。
- 优势：大幅度释放上下文空间。

## 3.上下文检索

- 检索工具：基于索引的语义搜索，或更简单的基于文件系统的搜索工具（如 glob 和 grep）。
- 检索形式：模型主动检索、根据流程的被动检索。

## 4.上下文隔离
- 优势：关注点分离，每个子代理拥有自己独立的、更小的上下文窗口。
- 缺点：需要额外的代理，需要额外的资源。

# 使用技巧

- 设置“腐烂阈值”，比如128K。
- 先“压缩”，后“摘要”：当上下文达到128K时，系统首先触发“压缩”。只在“压缩”收益也变小时，才万不得已触发“摘要”。
- “压缩”的艺术：执行“压缩”时，只压缩最老的50%历史，并保留最新的50%工具调用的完整信息。这能确保模型有足够的新鲜“样例”来模仿，防止其行为错乱。
- “摘要”技巧：执行“摘要”时，会使用原始的、未经压缩的数据来总结，以保证信息保真度。并且，同样会保留最后几个工具调用的全量信息，防止模型“忘记自己刚刚在干什么”。

# 思考
- 最终哲学：构建更少，理解更多（Build less and understand more）
- 上下文工程的真正目标，不是让系统更复杂，而是让模型的工作，变得更简单。


